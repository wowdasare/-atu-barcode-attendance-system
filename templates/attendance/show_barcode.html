{% extends 'attendance/base.html' %}

{% block title %}Student Barcode - {{ student.first_name }} {{ student.last_name }}{% endblock %}

{% block content %}
<style>
    .qr-display-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 30px;
        border: none;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .qr-header {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
        padding: 3rem 2rem;
        text-align: center;
        color: white;
        position: relative;
    }
    
    .qr-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
    }
    
    .qr-header h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 2;
    }
    
    .qr-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0;
        position: relative;
        z-index: 2;
    }
    
    .student-avatar {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #fff 0%, #f0f9ff 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 2rem;
        color: var(--primary-blue);
        border: 4px solid white;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 2;
    }
    
    .qr-body {
        padding: 3rem;
        text-align: center;
    }
    
    .qr-code-container {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        margin: 2rem 0;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        border: 3px solid var(--primary-blue-light);
        position: relative;
        display: inline-block;
    }
    
    .qr-code-container::before {
        content: '';
        position: absolute;
        top: -3px;
        left: -3px;
        right: -3px;
        bottom: -3px;
        background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue), var(--accent-blue), var(--primary-blue));
        border-radius: 20px;
        z-index: -1;
        animation: gradient 3s ease infinite;
        background-size: 400% 400%;
    }
    
    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .qr-code-image {
        max-width: 280px;
        max-height: 280px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .student-info {
        background: var(--gray-50);
        border-radius: 15px;
        padding: 1.5rem;
        margin: 2rem 0;
    }
    
    .barcode-id-display {
        background: var(--primary-blue-light);
        border: 2px dashed var(--primary-blue);
        border-radius: 10px;
        padding: 1rem;
        margin: 1.5rem 0;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        color: var(--primary-blue);
        word-break: break-all;
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 2rem;
    }
    
    .qr-footer {
        background: var(--gray-50);
        padding: 2rem;
        text-align: center;
        border-top: 1px solid var(--gray-200);
    }
    
    @media (max-width: 768px) {
        .qr-header {
            padding: 2rem 1rem;
        }
        
        .qr-body {
            padding: 2rem 1rem;
        }
        
        .qr-code-image {
            max-width: 220px;
            max-height: 220px;
        }
        
        .action-buttons {
            flex-direction: column;
        }
    }
</style>

<div class="container py-4">
    <!-- Back Button -->
    <div class="mb-4">
        <a href="{% url 'attendance_web:manage_students' %}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Students
        </a>
    </div>

    <!-- QR Code Display Card -->
    <div class="qr-display-card">
        <!-- Header -->
        <div class="qr-header">
            <div class="student-avatar">
                <i class="fas fa-user-graduate"></i>
            </div>
            <h2>{{ student.first_name }} {{ student.last_name }}</h2>
            <p>{{ student.student_id }} • {{ student.program }}</p>
        </div>
        
        <!-- Body -->
        <div class="qr-body">
            <!-- Student Information -->
            <div class="student-info">
                <div class="row text-start">
                    <div class="col-md-6 mb-3">
                        <strong class="text-muted d-block mb-1">Student ID</strong>
                        <span class="fs-5">{{ student.student_id }}</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong class="text-muted d-block mb-1">Full Name</strong>
                        <span class="fs-5">{{ student.first_name }} {{ student.last_name }}</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong class="text-muted d-block mb-1">Email</strong>
                        <span class="fs-6">{{ student.email }}</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong class="text-muted d-block mb-1">Program</strong>
                        <span class="fs-6">{{ student.program }}</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong class="text-muted d-block mb-1">Level</strong>
                        <span class="fs-6">Level {{ student.level }}</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong class="text-muted d-block mb-1">Status</strong>
                        {% if student.is_active %}\n                            <span class=\"badge bg-success px-3 py-2\">Active</span>\n                        {% else %}\n                            <span class=\"badge bg-danger px-3 py-2\">Inactive</span>\n                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- QR Code -->
            <div class="qr-code-container">
                <img src="{% url 'attendance_web:serve_barcode' student.id %}" 
                     alt="QR Code for {{ student.student_id }}" 
                     class="qr-code-image">
                <div class="mt-3">
                    <i class="fas fa-qrcode text-primary me-2"></i>
                    <span class="text-muted">Scan this QR code for attendance</span>
                </div>
            </div>
            
            <!-- Barcode ID -->
            <div class="barcode-id-display">
                <i class="fas fa-fingerprint me-2"></i>
                <strong>Barcode ID:</strong><br>
                <span class="fs-6">{{ student.barcode_id }}</span>
            </div>
            
            <!-- Usage Instructions -->
            <div class="alert alert-info border-0 rounded-3" style="background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%); color: var(--primary-blue);">
                <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>How to Use</h6>
                <p class="mb-0 small">Students should scan this QR code during attendance sessions. Each code is unique and securely identifies the student in the system.</p>
            </div>
        </div>
        
        <!-- Footer with Actions -->
        <div class="qr-footer">
            <div class="action-buttons">
                <a href="{% url 'attendance_web:serve_barcode' student.id %}" 
                   target="_blank" class="btn btn-primary btn-lg px-4">
                    <i class="fas fa-download me-2"></i>Download QR Code
                </a>
                <a href="{% url 'attendance_web:generate_barcode' student.id %}" 
                   class="btn btn-outline-secondary btn-lg px-4"
                   onclick="return confirm('Are you sure you want to regenerate the QR code? This will invalidate the current code.')">
                    <i class="fas fa-sync-alt me-2"></i>Regenerate
                </a>
                <a href="{% url 'attendance_web:edit_student' student.id %}" 
                   class="btn btn-outline-primary btn-lg px-4">
                    <i class="fas fa-edit me-2"></i>Edit Student
                </a>
            </div>
            
            <div class="mt-4 pt-3 border-top">
                <small class="text-muted">
                    <i class="fas fa-shield-alt me-2"></i>
                    QR Code generated on {{ student.created_at|date:"M d, Y" }} • 
                    Last updated {{ student.updated_at|date:"M d, Y H:i" }}
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}